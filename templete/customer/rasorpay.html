<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Payment Page</title>
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">

</head>
<body>
    <div class="container mt-5">
        <div class="row justify-content-center">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header" style="color:white;background-color:#567253">
                        <h3 class="card-title">Order Details</h3>
                    </div>
                    <div class="card-body">
                        <table class="table">
                            <tbody>
                                <tr>
                                    <th>Order ID:</th>
                                    <td>{{order_id}}</td>
                                </tr>
                    
                                <tr>
                                    <th>Total:</th>
                                    <td><strong>{{amount}}</strong></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="card-footer">
                        
                        <button type="submit"  class= "btn"style="color:white;background-color:#567253"id="pay-button">Pay â‚¹{{ amount|floatformat:"2" }}</button>
                      
                    </div>
                </div>
            </div>
        </div>
    </div>


<script>
     //-- Razorpay....................... -->
     
        var options = {
            "key": "{{ key_id }}",  // Razorpay public key
            "amount": "{{ amount }}",  // Amount in paise
            "currency": "INR",
            "name": "Luahaura",
            "description": "Test Payment",
            "order_id": "{{ order_id }}",  // Order ID from the server
            handler: function (response) {
                // Send the response to your server for verification
                fetch('/customer/verify_payment/{{order}}/{{status}}/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': '{{ csrf_token }}',  // Add the CSRF token
                    },
                    body: JSON.stringify(response)
                })
                .then(response => response.json())
                .then(data => {
                    // Handle the server response here
                    console.log(data);
                    if (data.message === "Payment verified successfully!") {
                        window.location.href = "/customer/rasorpay_order_status/{{order}}/{{status}}/"; 
                        alert("Payment verification successful!");
                    } else {
                        alert("Payment verification failed!");
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                });
            }

        // "theme": {
              //  "color": "#3399cc",
          //  } //
        };

        var rzp = new Razorpay(options);
        document.getElementById('pay-button').onclick = function (e) {
            rzp.open();
            e.preventDefault();
        }
    </script>

</body>
</html>