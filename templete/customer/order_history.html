{% extends 'customer/base.html' %}
{% load static %}

{% block link_block %}
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
<link rel="stylesheet" href="{% static 'customer/orderhistory.css' %}">
<link rel="stylesheet" href="{% static 'footer.css' %}">
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
{% endblock %}

{% block body_content %}
{% include 'customer/custmor_nav.html' %}
<nav class="navbar bg-secondary seccond_nav ">
    <div class="container-fluid ">
        <a class="navbar-brand">Order History</a>
    </div>
</nav>

<div class="container mt-4">
    <h3 class="mb-4 text-center" style="color: var(--primary-color);">Your Order History</h3>
    {% if orders %}
    {% for order in orders %}
    <div class="card mb-4 order-card">
       <small style="margin-left:1em; color:#567253">ordered:-{{ order.created_at|date:"Y-m" }}</small>
       <small style="margin-left:1em; color:#567253">Payment Method:-{{order.Payment.payment_category}}</small>
        <div class="card-body">
            <div class="row align-items-center">
                <div class="col-md-2 text-center mb-3 mb-md-0">
                    <img src="{{order.product.image_1.url}}" alt="Product" class="product-img">
                </div>
                <div class="col-md-3 mb-3 mb-md-0">
                    <h5 class="card-title">{{order.product.product_name}}</h5>
                    <p class="card-text text-muted">{{order.product.price}}-Rs/</p>
                </div>
                <div class="col-md-3 mb-3 text-secondary mb-md-0">
                    <p class="mb-1"><strong>Address:</strong> {{order.delivery_address}}</p>
                    <p class="mb-1"><strong>Pincode:</strong> {{order.pincode}}</p>
                    <p class="mb-1"><strong>Phone:</strong> {{order.phone_number}}</p>
                </div>
                <div class="col-md-2 text-secondary mb-3 mb-md-0">
                    <p class="mb-1"><strong>Quantity:</strong> {{order.quantity}}</p>
                    <p class="mb-1"><strong>Total:</strong> {{order.total_amount}}-Rs/</p>
                </div>
                
                <div class="col-md-2 text-md-end">
                 {% if order.Payment != None %}
                    {% if order.order_status == "Pending" %}
                        <span class="badge bg-warning text-dark status-badge">Pending</span>
                    {% elif order.order_status == 'Delivered' %}
                        <span class="badge bg-success status-badge">Delivered</span>
                    {% elif order.order_status == 'Shipping' %}
                        <span class="badge bg-info status-badge">Shipped</span>
                    {% elif order.order_status == 'Cancelled' %}
                        <span class="badge bg-danger status-badge">Cancelled</span>
                    {% elif order.order_status == 'Confirmed' %}
                        <span class="badge bg-primary status-badge">Confirmed</span>
                    {% elif order.order_status == 'Return' %}
                        <span class="badge bg-warning status-badge">Return</span>
                    {% elif order.order_status == 'Returned' %}
                        <span class="badge bg-secondary status-badge">Returned</span>
                    {% endif %}

                    {% for date in order_dates %}
                        {% if date.order_id == order.id %}
                            {% if order.order_status == 'Confirmed' %}
                                <p class="mb-2 mt-2 text-secondary "><small>Expected delivery: {{date.expect_date}}</small></p>
                            {% endif %}
                            {% if order.order_status == 'Shipping' %}
                                <p class="mb-2 mt-2 text-secondary "><small>Delivered on: {{date.delivery_date}}</small></p>
                            {% endif %}
                        {% endif %}
                    {% endfor %}

                    {% if order.order_status != 'Cancelled' and order.order_status != 'Delivered' and order.order_status != 'Return' and order.order_status != 'Returned' %}
                        <a href="{% url 'customer:order_cancel' order.id %}" class="btn btn-outline-danger btn-sm cancel-btn mt-2">
                            <i class="fas fa-times-circle me-1"></i>Cancel Order
                        </a>
                    {% endif %}
                    {% if order.order_status == 'Delivered' %}
                        <a href="{% url 'customer:return' order.id %}" class="btn btn-outline-warning btn-sm cancel-btn mt-2">
                            <i class="fas fa-undo-alt me-1"></i>Return
                        </a>
                    {% endif %}
                    {% else %}
                    <a href="{% url 'customer:rasorpay' order.id 'single_product_checkout'  %}" class="btn btn-outline-danger btn-sm cancel-btn mt-2">
                        <i class="fa-thin fa-money-check-pen"></i>Pay Now
                    </a>
                    <span class="badge bg-danger mt-2  status-badge">Payment failed..!</span>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
    {% endfor %}
    {% else %}
    <div class="alert alert-secondary" role="alert">
        You have no orders !
      </div>
      <div style="height:50vh;">
         
      </div>
    {% endif %}
</div>

{% include 'footer.html' %}
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/toastify-js"></script>

<!-- Toastify Messages -->
{% if messages %}
{% for msg in messages %}
<script>
    Toastify({
        text: "{{ msg }}",
        className: "info",
        style: {
            background: "linear-gradient(to right, var(--primary-color), var(--secondary-color))",
        }
    }).showToast();
</script>
{% endfor %}
{% endif %}

{% endblock %}